{% extends "base.html" %}
{% block title %}Usu√°rios - Play Beach Tennis{% endblock %}
{% block content %}

<section class="form-section">
  <h2>üë• Gerenciar Usu√°rios</h2>

  <table id="tabelaUsuarios">
    <thead>
      <tr>
        <th>#</th>
        <th>Nome</th>
        <th>Sexo</th>
        <th>Idade</th>
        <th>Telefone</th>
        <th>Cidade</th>
        <th>Email</th>
        <th>A√ß√µes</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<script>
document.addEventListener("DOMContentLoaded", async () => {

  async function carregarUsuarios() {
    const res = await fetch("/api/usuarios", { credentials: "include" });
    const usuarios = await res.json();
    const tbody = document.querySelector("#tabelaUsuarios tbody");
    tbody.innerHTML = "";

    usuarios.forEach((u, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${u.nome}</td>
        <td>${u.sexo || "-"}</td>
        <td>${u.idade || "-"}</td>
        <td>${u.telefone || "-"}</td>
        <td>${u.cidade || "-"}</td>
        <td>${u.email}</td>
        <td>
          <button class="btn-editar" onclick="editarUsuario(${u.id}, '${u.nome}', '${u.telefone}', '${u.cidade}')">‚úè Editar</button>
          <button class="btn-excluir" onclick="excluirUsuario(${u.id})">üóë Excluir</button>
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  window.editarUsuario = async (id, nome, telefone, cidade) => {
    const novoNome = prompt("Novo nome:", nome);
    const novoTelefone = prompt("Novo telefone:", telefone);
    const novaCidade = prompt("Nova cidade:", cidade);

    const res = await fetch(`/api/usuarios/${id}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ nome: novoNome, telefone: novoTelefone, cidade: novaCidade })
    });
    const json = await res.json();
    alert(json.mensagem || json.erro);
    carregarUsuarios();
  };

  window.excluirUsuario = async (id) => {
    if (!confirm("Deseja excluir este usu√°rio?")) return;
    const res = await fetch(`/api/usuarios/${id}`, { method: "DELETE" });
    const json = await res.json();
    alert(json.mensagem || json.erro);
    carregarUsuarios();
  };

  await carregarUsuarios();
});
</script>

{% endblock %}
