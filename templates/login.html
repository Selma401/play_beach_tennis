{% extends "base.html" %}
{% block title %}Login â€” Play Beach Tennis{% endblock %}

{% block content %}

<section class="container form-container" style="max-width:450px;margin:auto;">
  <div class="card form-card" style="padding:25px;">
    <h2>ðŸ”‘ Acesso ao Sistema</h2>
    <p class="subtitle" style="color:#555;">Entre com suas credenciais para continuar.</p>

    <div id="login-message" class="alert-box" style="display:none;margin-bottom:10px;"></div>

    <form id="login-form">
      <div class="form-group" style="margin-bottom:12px;">
        <label for="email">Email:</label>
        <input type="email" id="email" class="input-text" required placeholder="seuemail@exemplo.com" style="width:100%;padding:8px;">
      </div>

      <div class="form-group" style="margin-bottom:12px;">
        <label for="senha">Senha:</label>
        <input type="password" id="senha" class="input-text" required placeholder="********" style="width:100%;padding:8px;">
      </div>

      <button type="submit" class="btn primary full" style="width:100%;margin-top:8px;">Entrar</button>

      <p class="text-center" style="margin-top:14px;">
      <div class="login-links">
        <a href="/register">Ainda nÃ£o tem conta? Cadastre-se</a><br>
        <a href="/forgot">Esqueci minha senha</a>
      </div>
</section>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  const form = document.getElementById('login-form');
  const messageBox = document.getElementById('login-message');
  if (!form) return;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = document.getElementById('email').value.trim();
    const senha = document.getElementById('senha').value.trim();

    messageBox.style.display = 'block';
    messageBox.className = 'alert-box';
    messageBox.textContent = 'Verificando...';

    try {
      const res = await fetch("/api/login", {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ email, senha })
      });

      const data = await res.json();

      if (res.ok) {
        messageBox.className = 'alert-box success';
        messageBox.textContent = data.mensagem + " Redirecionando...";
        setTimeout(() => {
          window.location.href = "/dashboard"; // âœ… sempre redireciona corretamente
        }, 800);
      } else {
        messageBox.className = 'alert-box danger';
        messageBox.textContent = data.erro || "Email ou senha incorretos.";
      }

    } catch (err) {
      console.error("Erro:", err);
      messageBox.className = 'alert-box danger';
      messageBox.textContent = "Falha ao conectar ao servidor.";
    }
  });
});
</script>
{% endblock %}
